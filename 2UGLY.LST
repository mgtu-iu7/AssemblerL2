; R0 0B00h,0B01h
; R1 0B02h,0B03h
; R2 0B04h,0B05h
; R3 0B06h,0B07h
; R4 0B08h,0B09h
; R5 0B0Ah,0B0Bh для индексной адресации (в него записывать адрес)
; R6 (SP) 0B0Ch,0B0Dh
; R7 (PC) 0B0Eh,0B0Fh
; CR 0AF0h,0AF1h регистр машинного кода (память,содержащая программу)


0000: __            |              $ADR   0000H        ; старший бит эмулированных регистров находится в старшей ячейке
0000: 21 31 D4      |              LXI    H, 54321     ; 1101 0100 0011 0001 заполняем регистр R0 произвольным значением
0003: 22 00 0B      |              SHLD   0B00H
0006: 21 00 0B      |              LXI    H, 0B00H     ; установка счетчика стека на R1 (0b00h) 
0009: F9            |              SPHL                ; через hl,так как напрямую баг,путаются 2и3 значения в хексе при записи в сп.
000A: 21 C0 3D      |              LXI    H, 15808     ; 0011 1101 11000000 машинный код команды (адресация по умолчанию регистровая прямая)
000D: DB 20         |              IN     20H          ; Считываем код способа адресации (варианты 100 (4) и 110(6))
000F: 01 06 04      |              LXI    B, 406H      ; (B=4 C=6)
0012: B9            |              CMP    C
0013: CA 30 00      |              JZ     VAR2
0016: B8            |              CMP    B
0017: C2 5B 00      |              JNZ    END
001A: 21 02 0B      |              LXI    H, 0B02H     ; установка счетчика стека на R1 (0b02h) 1011 0000 0010
001D: F9            |              SPHL                ; через hl,так как напрямую баг,путаются 2и3 значения в хексе при записи в сп.
001E: 01 04 00      |              LXI    B, 4
0021: 09            |              DAD    B
0022: 22 F0 0A      |              SHLD   0AF0H        ; Пересылка машинного кода команды из HL в регистр мк.
0025: 21 F0 0A      |              LXI    H, 0AF0H
0028: 22 0E 0B      |              SHLD   0B0EH        ; Запись в регистр команд адреса команды 
002B: 3B            |              DCX    SP           ; Автодекрементная прямая:COM (SP)
002C: 3B            |              DCX    SP           ; sp => 0b00h (-2,так как работаем с 16битными значениями)
002D: C3 4B 00      |              JMP    TAIL

                    | var2:               
0030: 01 06 00      |              LXI    B, 6         ; A->BC
0033: 09            |              DAD    B            ; HL+=BC Индексная прямая:COM 250(R5)
0034: 22 F0 0A      |              SHLD   0AF0H        ; Пересылка машинного кода команды из HL в регистр мк.
0037: 21 F0 0A      |              LXI    H, 0AF0H     ; адрес рк в hl
003A: 22 0E 0B      |              SHLD   0B0EH        ; Запись в регистр команд адреса команды
003D: 21 06 0A      |              LXI    H, 0A06H
0040: 22 0A 0B      |              SHLD   0B0AH        ; загружаем в регистр р5 адрес,который +250 = адр р0.MVI SP,0b0ah;

0043: 2A 0A 0B      |              LHLD   0B0AH
0046: 01 FA 00      |              LXI    B, 250
0049: 09            |              DAD    B            ; hl - адрес
004A: F9            |              SPHL                ; HL>SP sp=adr r0

                    | tail:               
004B: C1            |              POP    B            ; sp => 0b02h,содержимое r0 в регистре bc
004C: 78            |              MOV    A, B
004D: 2F            |              CMA    
004E: 47            |              MOV    B, A
004F: 79            |              MOV    A, C
0050: 2F            |              CMA    
0051: 4F            |              MOV    C, A
0052: C5            |              PUSH   B            ; возвращаем в регистр r0,конец выполнения команды. sp => 0b00h
0053: 2A 0E 0B      |              LHLD   0B0EH
0056: 23            |              INX    H
0057: 23            |              INX    H
0058: 22 0E 0B      |              SHLD   0B0EH        ; регистр команд указывает на следующую яч.
                    | end:                










   -------------------------------------------------
             ЋЎ­ аг¦Ґ­­лҐ Ё¤Ґ­вЁдЁЄ в®ал

      VAR2 <0030>             TAIL <004B>
      END <005B>
